
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOP Builder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* A small style to make the preview scrollable on its own */
        #sop-preview-container-wrapper {
            max-height: 70vh; /* Set a max height */
        }
    </style>
</head>
<body class="bg-white flex items-center justify-center min-h-screen py-4 px-4">

    <!-- Main Card Wrapper -->
    <div class="w-full mx-auto rounded-2xl flex min-h-[90vh]">
        <div class="flex flex-col md:flex-row w-full">
            
            <!-- Sidebar -->
            <div class="w-full md:w-1/4 lg:w-1/5 p-4 md:p-8 border-b md:border-b-0 md:border-r border-gray-200 md:sticky top-0 h-screen overflow-y-auto">
                <h2 class="text-xl font-bold text-gray-800 mb-6 hidden md:block">SOP Builder</h2>
                
                <!-- New Sidebar Stepper -->
                <div id="stepper" class="flex flex-row md:flex-col md:space-y-2">
                    
                    <!-- Step 1 -->
                    <div class="stepper-item flex-1 md:flex-none" data-step="1">
                        <div class="stepper-anchor flex items-center space-x-3 p-3 rounded-lg">
                            <div class="stepper-circle w-8 h-8 md:w-10 md:h-10 bg-blue-600 border-2 border-blue-600 rounded-full flex items-center justify-center text-white font-bold text-lg flex-shrink-0">1</div>
                            <div class="hidden md:block">
                                <p class="stepper-label text-sm font-medium text-blue-600">Details</p>
                                <p class="text-xs text-gray-500">University & CV</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Step 2 -->
                    <div class="stepper-item flex-1 md:flex-none" data-step="2">
                         <div class="stepper-anchor flex items-center space-x-3 p-3 rounded-lg">
                            <div class="stepper-circle w-8 h-8 md:w-10 md:h-10 bg-white border-2 border-gray-300 rounded-full flex items-center justify-center text-gray-500 font-bold text-lg flex-shrink-0">2</div>
                            <div class="hidden md:block">
                                <p class="stepper-label text-sm font-medium text-gray-500">Content</p>
                                 <p class="text-xs text-gray-500">Core sections</p>
                            </div>
                        </div>
                    </div>

                    <!-- Step 3 -->
                    <div class="stepper-item flex-1 md:flex-none" data-step="3">
                         <div class="stepper-anchor flex items-center space-x-3 p-3 rounded-lg">
                            <div class="stepper-circle w-8 h-8 md:w-10 md:h-10 bg-white border-2 border-gray-300 rounded-full flex items-center justify-center text-gray-500 font-bold text-lg flex-shrink-0">3</div>
                            <div class="hidden md:block">
                                <p class="stepper-label text-sm font-medium text-gray-500">Style</p>
                                 <p class="text-xs text-gray-500">Writing tone</p>
                            </div>
                        </div>
                    </div>

                    <!-- Step 4 -->
                    <div class="stepper-item flex-1 md:flex-none" data-step="4">
                         <div class="stepper-anchor flex items-center space-x-3 p-3 rounded-lg">
                            <div class="stepper-circle w-8 h-8 md:w-10 md:h-10 bg-white border-2 border-gray-300 rounded-full flex items-center justify-center text-gray-500 font-bold text-lg flex-shrink-0">4</div>
                            <div class="hidden md:block">
                                <p class="stepper-label text-sm font-medium text-gray-500">Design</p>
                                 <p class="text-xs text-gray-500">Select template</p>
                            </div>
                        </div>
                    </div>

                    <!-- Step 5 -->
                    <div class="stepper-item flex-1 md:flex-none" data-step="5">
                         <div class="stepper-anchor flex items-center space-x-3 p-3 rounded-lg">
                            <div class="stepper-circle w-8 h-8 md:w-10 md:h-10 bg-white border-2 border-gray-300 rounded-full flex items-center justify-center text-gray-500 font-bold text-lg flex-shrink-0">5</div>
                            <div class="hidden md:block">
                                <p class="stepper-label text-sm font-medium text-gray-500">Preview</p>
                                 <p class="text-xs text-gray-500">Generate & Download</p>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <!-- Main Content -->
            <div class="w-full md:w-3/4 lg:w-4/5 p-6 md:p-10">
                <h1 class="text-3xl font-bold text-gray-800 mb-2">Create Your Statement of Purpose</h1>
                <p class="text-gray-500 mb-10">Follow the steps to generate your document.</p>

                <!-- Form (moved from original position) -->
                <form id="sop-form">
                    
            <div class="step-content" data-step="1">
                <h3 class="text-2xl font-semibold text-gray-700 mb-6">Step 1: Basic Information</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div class="relative">
                        <label for="university-search" class="block mb-2 text-sm font-medium text-gray-700">University Name</label>
                        <input type="text" id="university-search" class="block w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., Stanford University" autocomplete="off">
                        <div id="university-dropdown" class="absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg hidden max-h-60 overflow-y-auto"></div>
                    </div>
                    <div class="relative">
                        <label for="program-search" class="block mb-2 text-sm font-medium text-gray-700">Program Name</label>
                        <input type="text" id="program-search" class="block w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., M.S. in Computer Science" autocomplete="off">
                        <div id="program-dropdown" class="absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg hidden max-h-60 overflow-y-auto"></div>
                    </div>
                </div>
                <div>
                    <label class="block mb-2 text-sm font-medium text-gray-700">CV/Resume</label>
                    <div class="flex items-center space-x-4 mb-4">
                        <label class="flex items-center">
                            <input type="radio" name="cv-option" value="upload" class="h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500" checked>
                            <span class="ml-2 text-sm text-gray-700">Upload new CV/Resume</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="cv-option" value="existing" class="h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500">
                            <span class="ml-2 text-sm text-gray-700">Use existing CV/Resume</span>
                        </label>
                    </div>
                    <div id="cv-upload-area" class="flex items-center justify-center w-full">
                        <label for="cv-upload" class="flex flex-col items-center justify-center w-full h-48 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100">
                            <div class="flex flex-col items-center justify-center pt-5 pb-6">
                                <svg class="w-10 h-10 mb-3 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg>
                                <p class="mb-2 text-sm text-gray-500"><span class="font-semibold">Click to upload</span> or drag and drop</p>
                                <p class="text-xs text-gray-500">PDF, DOC, or DOCX (MAX. 5MB)</p>
                            </div>
                            <input id="cv-upload" type="file" class="hidden"/>
                        </label>
                    </div>
                    <div id="existing-cv-area" class="hidden">
                        <p class="text-sm text-gray-600 mb-3">Please select one of your saved CVs:</p>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mx-auto">
                            <label class="relative p-4 border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50 has-[:checked]:bg-blue-50 has-[:checked]:border-blue-500">
                                <input type="radio" name="existing-cv" value="cv1" class="absolute top-4 right-4 h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500" checked>
                                <div class="flex flex-row items-center">
                                    <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 56 56" style="enable-background:new 0 0 56 56;" xml:space="preserve" class="w-10 h-10 flex-shrink-0">
                                        <g>
                                            <path style="fill:#E9E9E0;" d="M36.985,0H7.963C7.155,0,6.5,0.655,6.5,1.926V55c0,0.345,0.655,1,1.463,1h40.074 c0.808,0,1.463-0.655,1.463-1V12.978c0-0.696-0.093-0.92-0.257-1.085L37.607,0.257C37.442,0.093,37.218,0,36.985,0z"/>
                                            <polygon style="fill:#D9D7CA;" points="37.5,0.151 37.5,12 49.349,12 	"/>
                                            <path style="fill:#CC4B4C;" d="M19.514,33.324L19.514,33.324c-0.348,0-0.682-0.113-0.967-0.326 c-1.041-0.781-1.181-1.65-1.115-2.242c0.182-1.628,2.195-3.332,5.985-5.068c1.504-3.296,2.935-7.357,3.788-10.75 c-0.998-2.172-1.968-4.99-1.261-6.643c0.248-0.579,0.557-1.023,1.134-1.215c0.228-0.076,0.804-0.172,1.016-0.172 c0.504,0,0.947,0.649,1.261,1.049c0.295,0.376,0.964,1.173-0.373,6.802c1.348,2.784,3.258,5.62,5.088,7.562 c1.311-0.237,2.439-0.358,3.358-0.358c1.566,0,2.515,0.365,2.902,1.117c0.32,0.622,0.189,1.349-0.39,2.16 c-0.557,0.779-1.325,1.191-2.22,1.191c-1.216,0-2.632-0.768-4.211-2.285c-2.837,0.593-6.15,1.651-8.828,2.822 c-0.836,1.774-1.637,3.203-2.383,4.251C21.273,32.654,20.389,33.324,19.514,33.324z M22.176,28.198 c-2.137,1.201-3.008,2.188-3.071,2.744c-0.01,0.092-0.037,0.334,0.431,0.692C19.685,31.587,20.555,31.19,22.176,28.198z M35.813,23.756c0.815,0.627,1.014,0.944,1.547,0.944c0.234,0,0.901-0.01,1.21-0.441c0.149-0.209,0.207-0.343,0.23-0.415 c-0.123-0.065-0.286-0.197-1.175-0.197C37.12,23.648,36.485,23.67,35.813,23.756z M28.343,17.174 c-0.715,2.474-1.659,5.145-2.674,7.564c2.09-0.811,4.362-1.519,6.496-2.02C30.815,21.15,29.466,19.192,28.343,17.174z M27.736,8.712c-0.098,0.033-1.33,1.757,0.096,3.216C28.781,9.813,27.779,8.698,27.736,8.712z"/>
                                            <path style="fill:#CC4B4C;" d="M48.037,56H7.963C7.155,56,6.5,55.345,6.5,54.537V39h43v15.537C49.5,55.345,48.845,56,48.037,56z"/>
                                            <g>
                                                <path style="fill:#FFFFFF;" d="M17.385,53h-1.641V42.924h2.898c0.428,0,0.852,0.068,1.271,0.205 c0.419,0.137,0.795,0.342,1.128,0.615c0.333,0.273,0.602,0.604,0.807,0.991s0.308,0.822,0.308,1.306 c0,0.511-0.087,0.973-0.26,1.388c-0.173,0.415-0.415,0.764-0.725,1.046c-0.31,0.282-0.684,0.501-1.121,0.656 s-0.921,0.232-1.449,0.232h-1.217V53z M17.385,44.168v3.992h1.504c0.2,0,0.398-0.034,0.595-0.103 c0.196-0.068,0.376-0.18,0.54-0.335c0.164-0.155,0.296-0.371,0.396-0.649c0.1-0.278,0.15-0.622,0.15-1.032 c0-0.164-0.023-0.354-0.068-0.567c-0.046-0.214-0.139-0.419-0.28-0.615c-0.142-0.196-0.34-0.36-0.595-0.492 c-0.255-0.132-0.593-0.198-1.012-0.198H17.385z"/>
                                                <path style="fill:#FFFFFF;" d="M32.219,47.682c0,0.829-0.089,1.538-0.267,2.126s-0.403,1.08-0.677,1.477s-0.581,0.709-0.923,0.937 s-0.672,0.398-0.991,0.513c-0.319,0.114-0.611,0.187-0.875,0.219C28.222,52.984,28.026,53,27.898,53h-3.814V42.924h3.035 c0.848,0,1.593,0.135,2.235,0.403s1.176,0.627,1.6,1.073s0.74,0.955,0.95,1.524C32.114,46.494,32.219,47.08,32.219,47.682z M27.352,51.797c1.112,0,1.914-0.355,2.406-1.066s0.738-1.741,0.738-3.09c0-0.419-0.05-0.834-0.15-1.244 c-0.101-0.41-0.294-0.781-0.581-1.114s-0.677-0.602-1.169-0.807s-1.13-0.308-1.914-0.308h-0.957v7.629H27.352z"/>
                                                <path style="fill:#FFFFFF;" d="M36.266,44.168v3.172h4.211v1.121h-4.211V53h-1.668V42.924H40.9v1.244H36.266z"/>
                                            </g>
                                        </g>
                                    </svg>
                                    <div class="ml-4">
                                        <span class="font-medium text-gray-800 text-sm break-all">John_Doe_Resume_2024.pdf</span>
                                        <span class="text-xs text-gray-500 mt-1 block">1.2 MB</span>
                                    </div>
                                </div>
                            </label>
                            <label class="relative p-4 border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50 has-[:checked]:bg-blue-50 has-[:checked]:border-blue-500">
                                <input type="radio" name="existing-cv" value="cv2" class="absolute top-4 right-4 h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500">
                                <div class="flex flex-row items-center">
                                    <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 56 56" style="enable-background:new 0 0 56 56;" xml:space="preserve" class="w-10 h-10 flex-shrink-0">
                                        <g>
                                            <path style="fill:#E9E9E0;" d="M36.985,0H7.963C7.155,0,6.5,0.655,6.5,1.926V55c0,0.345,0.655,1,1.463,1h40.074 c0.808,0,1.463-0.655,1.463-1V12.978c0-0.696-0.093-0.92-0.257-1.085L37.607,0.257C37.442,0.093,37.218,0,36.985,0z"/>
                                            <polygon style="fill:#D9D7CA;" points="37.5,0.151 37.5,12 49.349,12 	"/>
                                            <path style="fill:#CC4B4C;" d="M19.514,33.324L19.514,33.324c-0.348,0-0.682-0.113-0.967-0.326 c-1.041-0.781-1.181-1.65-1.115-2.242c0.182-1.628,2.195-3.332,5.985-5.068c1.504-3.296,2.935-7.357,3.788-10.75 c-0.998-2.172-1.968-4.99-1.261-6.643c0.248-0.579,0.557-1.023,1.134-1.215c0.228-0.076,0.804-0.172,1.016-0.172 c0.504,0,0.947,0.649,1.261,1.049c0.295,0.376,0.964,1.173-0.373,6.802c1.348,2.784,3.258,5.62,5.088,7.562 c1.311-0.237,2.439-0.358,3.358-0.358c1.566,0,2.515,0.365,2.902,1.117c0.32,0.622,0.189,1.349-0.39,2.16 c-0.557,0.779-1.325,1.191-2.22,1.191c-1.216,0-2.632-0.768-4.211-2.285c-2.837,0.593-6.15,1.651-8.828,2.822 c-0.836,1.774-1.637,3.203-2.383,4.251C21.273,32.654,20.389,33.324,19.514,33.324z M22.176,28.198 c-2.137,1.201-3.008,2.188-3.071,2.744c-0.01,0.092-0.037,0.334,0.431,0.692C19.685,31.587,20.555,31.19,22.176,28.198z M35.813,23.756c0.815,0.627,1.014,0.944,1.547,0.944c0.234,0,0.901-0.01,1.21-0.441c0.149-0.209,0.207-0.343,0.23-0.415 c-0.123-0.065-0.286-0.197-1.175-0.197C37.12,23.648,36.485,23.67,35.813,23.756z M28.343,17.174 c-0.715,2.474-1.659,5.145-2.674,7.564c2.09-0.811,4.362-1.519,6.496-2.02C30.815,21.15,29.466,19.192,28.343,17.174z M27.736,8.712c-0.098,0.033-1.33,1.757,0.096,3.216C28.781,9.813,27.779,8.698,27.736,8.712z"/>
                                            <path style="fill:#CC4B4C;" d="M48.037,56H7.963C7.155,56,6.5,55.345,6.5,54.537V39h43v15.537C49.5,55.345,48.845,56,48.037,56z"/>
                                            <g>
                                                <path style="fill:#FFFFFF;" d="M17.385,53h-1.641V42.924h2.898c0.428,0,0.852,0.068,1.271,0.205 c0.419,0.137,0.795,0.342,1.128,0.615c0.333,0.273,0.602,0.604,0.807,0.991s0.308,0.822,0.308,1.306 c0,0.511-0.087,0.973-0.26,1.388c-0.173,0.415-0.415,0.764-0.725,1.046c-0.31,0.282-0.684,0.501-1.121,0.656 s-0.921,0.232-1.449,0.232h-1.217V53z M17.385,44.168v3.992h1.504c0.2,0,0.398-0.034,0.595-0.103 c0.196-0.068,0.376-0.18,0.54-0.335c0.164-0.155,0.296-0.371,0.396-0.649c0.1-0.278,0.15-0.622,0.15-1.032 c0-0.164-0.023-0.354-0.068-0.567c-0.046-0.214-0.139-0.419-0.28-0.615c-0.142-0.196-0.34-0.36-0.595-0.492 c-0.255-0.132-0.593-0.198-1.012-0.198H17.385z"/>
                                                <path style="fill:#FFFFFF;" d="M32.219,47.682c0,0.829-0.089,1.538-0.267,2.126s-0.403,1.08-0.677,1.477s-0.581,0.709-0.923,0.937 s-0.672,0.398-0.991,0.513c-0.319,0.114-0.611,0.187-0.875,0.219C28.222,52.984,28.026,53,27.898,53h-3.814V42.924h3.035 c0.848,0,1.593,0.135,2.235,0.403s1.176,0.627,1.6,1.073s0.74,0.955,0.95,1.524C32.114,46.494,32.219,47.08,32.219,47.682z M27.352,51.797c1.112,0,1.914-0.355,2.406-1.066s0.738-1.741,0.738-3.09c0-0.419-0.05-0.834-0.15-1.244 c-0.101-0.41-0.294-0.781-0.581-1.114s-0.677-0.602-1.169-0.807s-1.13-0.308-1.914-0.308h-0.957v7.629H27.352z"/>
                                                <path style="fill:#FFFFFF;" d="M36.266,44.168v3.172h4.211v1.121h-4.211V53h-1.668V42.924H40.9v1.244H36.266z"/>
                                            </g>
                                        </g>
                                    </svg>
                                    <div class="ml-4">
                                        <span class="font-medium text-gray-800 text-sm break-all">JD_Portfolio_CS.pdf</span>
                                        <span class="text-xs text-gray-500 mt-1 block">3.4 MB</span>
                                    </div>
                                </div>
                            </label>
                            <label class="relative p-4 border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50 has-[:checked]:bg-blue-50 has-[:checked]:border-blue-500">
                                <input type="radio" name="existing-cv" value="cv3" class="absolute top-4 right-4 h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500">
                                <div class="flex flex-row items-center">
                                    <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 56 56" style="enable-background:new 0 0 56 56;" xml:space="preserve" class="w-10 h-10 flex-shrink-0">
                                        <g>
                                            <path style="fill:#E9E9E0;" d="M36.985,0H7.963C7.155,0,6.5,0.655,6.5,1.926V55c0,0.345,0.655,1,1.463,1h40.074 c0.808,0,1.463-0.655,1.463-1V12.978c0-0.696-0.093-0.92-0.257-1.085L37.607,0.257C37.442,0.093,37.218,0,36.985,0z"/>
                                            <polygon style="fill:#D9D7CA;" points="37.5,0.151 37.5,12 49.349,12 	"/>
                                            <path style="fill:#CC4B4C;" d="M19.514,33.324L19.514,33.324c-0.348,0-0.682-0.113-0.967-0.326 c-1.041-0.781-1.181-1.65-1.115-2.242c0.182-1.628,2.195-3.332,5.985-5.068c1.504-3.296,2.935-7.357,3.788-10.75 c-0.998-2.172-1.968-4.99-1.261-6.643c0.248-0.579,0.557-1.023,1.134-1.215c0.228-0.076,0.804-0.172,1.016-0.172 c0.504,0,0.947,0.649,1.261,1.049c0.295,0.376,0.964,1.173-0.373,6.802c1.348,2.784,3.258,5.62,5.088,7.562 c1.311-0.237,2.439-0.358,3.358-0.358c1.566,0,2.515,0.365,2.902,1.117c0.32,0.622,0.189,1.349-0.39,2.16 c-0.557,0.779-1.325,1.191-2.22,1.191c-1.216,0-2.632-0.768-4.211-2.285c-2.837,0.593-6.15,1.651-8.828,2.822 c-0.836,1.774-1.637,3.203-2.383,4.251C21.273,32.654,20.389,33.324,19.514,33.324z M22.176,28.198 c-2.137,1.201-3.008,2.188-3.071,2.744c-0.01,0.092-0.037,0.334,0.431,0.692C19.685,31.587,20.555,31.19,22.176,28.198z M35.813,23.756c0.815,0.627,1.014,0.944,1.547,0.944c0.234,0,0.901-0.01,1.21-0.441c0.149-0.209,0.207-0.343,0.23-0.415 c-0.123-0.065-0.286-0.197-1.175-0.197C37.12,23.648,36.485,23.67,35.813,23.756z M28.343,17.174 c-0.715,2.474-1.659,5.145-2.674,7.564c2.09-0.811,4.362-1.519,6.496-2.02C30.815,21.15,29.466,19.192,28.343,17.174z M27.736,8.712c-0.098,0.033-1.33,1.757,0.096,3.216C28.781,9.813,27.779,8.698,27.736,8.712z"/>
                                            <path style="fill:#CC4B4C;" d="M48.037,56H7.963C7.155,56,6.5,55.345,6.5,54.537V39h43v15.537C49.5,55.345,48.845,56,48.037,56z"/>
                                            <g>
                                                <path style="fill:#FFFFFF;" d="M17.385,53h-1.641V42.924h2.898c0.428,0,0.852,0.068,1.271,0.205 c0.419,0.137,0.795,0.342,1.128,0.615c0.333,0.273,0.602,0.604,0.807,0.991s0.308,0.822,0.308,1.306 c0,0.511-0.087,0.973-0.26,1.388c-0.173,0.415-0.415,0.764-0.725,1.046c-0.31,0.282-0.684,0.501-1.121,0.656 s-0.921,0.232-1.449,0.232h-1.217V53z M17.385,44.168v3.992h1.504c0.2,0,0.398-0.034,0.595-0.103 c0.196-0.068,0.376-0.18,0.54-0.335c0.164-0.155,0.296-0.371,0.396-0.649c0.1-0.278,0.15-0.622,0.15-1.032 c0-0.164-0.023-0.354-0.068-0.567c-0.046-0.214-0.139-0.419-0.28-0.615c-0.142-0.196-0.34-0.36-0.595-0.492 c-0.255-0.132-0.593-0.198-1.012-0.198H17.385z"/>
                                                <path style="fill:#FFFFFF;" d="M32.219,47.682c0,0.829-0.089,1.538-0.267,2.126s-0.403,1.08-0.677,1.477s-0.581,0.709-0.923,0.937 s-0.672,0.398-0.991,0.513c-0.319,0.114-0.611,0.187-0.875,0.219C28.222,52.984,28.026,53,27.898,53h-3.814V42.924h3.035 c0.848,0,1.593,0.135,2.235,0.403s1.176,0.627,1.6,1.073s0.74,0.955,0.95,1.524C32.114,46.494,32.219,47.08,32.219,47.682z M27.352,51.797c1.112,0,1.914-0.355,2.406-1.066s0.738-1.741,0.738-3.09c0-0.419-0.05-0.834-0.15-1.244 c-0.101-0.41-0.294-0.781-0.581-1.114s-0.677-0.602-1.169-0.807s-1.13-0.308-1.914-0.308h-0.957v7.629H27.352z"/>
                                                <path style="fill:#FFFFFF;" d="M36.266,44.168v3.172h4.211v1.121h-4.211V53h-1.668V42.924H40.9v1.244H36.266z"/>
                                            </g>
                                        </g>
                                    </svg>
                                    <div class="ml-4">
                                        <span class="font-medium text-gray-800 text-sm break-all">Doe_John_CV_Official.pdf</span>
                                        <span class="text-xs text-gray-500 mt-1 block">850 KB</span>
                                    </div>
                                </div>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="step-content hidden" data-step="2">
                <h3 class="text-2xl font-semibold text-gray-700 mb-6">Step 2: Core Content</h3>
                <p class="text-gray-500 mb-6">Select the sections you want to include and provide some details for each.</p>
                <div id="accordion-container" class="space-y-4">
                    <!-- About You Section -->
                    <div class="border border-gray-200 rounded-lg">
                        <button type="button" class="accordion-header flex justify-between items-center w-full p-4 text-left hover:bg-gray-50 focus:outline-none">
                            <span class="flex items-center">
                                <input id="cb-about" type="checkbox" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500" onclick="event.stopPropagation()">
                                <label for="cb-about" class="ml-3 text-md font-medium text-gray-800 cursor-pointer" onclick="event.stopPropagation()">About You / Self Introduction</label>
                            </span>
                            <svg class="accordion-icon w-5 h-5 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </button>
                        <div class="accordion-content hidden p-4 pt-0">
                            <textarea id="text-about" class="w-full p-3 h-32 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Write a few sentences about your background, passions, and why you're a good fit..."></textarea>
                        </div>
                    </div>

                    <!-- Motivation Section -->
                    <div class="border border-gray-200 rounded-lg">
                        <button type="button" class="accordion-header flex justify-between items-center w-full p-4 text-left hover:bg-gray-50 focus:outline-none">
                            <span class="flex items-center">
                                <input id="cb-motivation" type="checkbox" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500" onclick="event.stopPropagation()">
                                <label for="cb-motivation" class="ml-3 text-md font-medium text-gray-800 cursor-pointer" onclick="event.stopPropagation()">Motivation for this Program</label>
                            </span>
                            <svg class="accordion-icon w-5 h-5 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </button>
                        <div class="accordion-content hidden p-4 pt-0">
                            <textarea id="text-motivation" class="w-full p-3 h-32 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Why are you interested in this specific program and university? What do you hope to achieve?"></textarea>
                        </div>
                    </div>

                    <!-- Experience Section -->
                    <div class="border border-gray-200 rounded-lg">
                        <button type="button" class="accordion-header flex justify-between items-center w-full p-4 text-left hover:bg-gray-50 focus:outline-none">
                            <span class="flex items-center">
                                <input id="cb-exp" type="checkbox" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500" onclick="event.stopPropagation()">
                                <label for="cb-exp" class="ml-3 text-md font-medium text-gray-800 cursor-pointer" onclick="event.stopPropagation()">Research & Professional Experience</label>
                            </span>
                            <svg class="accordion-icon w-5 h-5 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </button>
                        <div class="accordion-content hidden p-4 pt-0">
                            <textarea id="text-exp" class="w-full p-3 h-32 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Summarize key projects, research, or job roles from your CV that are relevant to this program."></textarea>
                        </div>
                    </div>

                    <!-- Additional Description Section -->
                    <div class="mt-6">
                        <label for="text-additional" class="text-md font-medium text-gray-800">Additional Description</label>
                        <p class="text-sm text-gray-500 mb-2">Any other details you want to include? (e.g., future goals, specific professors you want to work with).</p>
                        <textarea id="text-additional" class="w-full p-3 h-32 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                    </div>

                    <!-- Professor Selection -->
                    <div class="mt-6">
                        <label for="professor-select" class="text-md font-medium text-gray-800">Professors of Interest</label>
                        <p class="text-sm text-gray-500 mb-2">Select any professors you are interested in working with (optional).</p>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <label for="prof-ng">
                                <input id="prof-ng" type="radio" name="professor" value="prof-ng" class="peer hidden">
                                <div class="p-4 border border-gray-300 rounded-lg cursor-pointer hover:border-blue-500 peer-checked:border-blue-600 peer-checked:bg-blue-50 peer-checked:ring-2 h-full flex flex-row items-center">
                                    <img src="https://placehold.co/64x64/E0E7FF/4F46E5?text=AN" alt="Professor Andrew Ng" class="w-16 h-16 rounded-full object-cover" onerror="this.src='https://placehold.co/64x64/E0E7FF/4F46E5?text=AN'">
                                    <div class="ml-4">
                                        <h4 class="font-semibold text-gray-800">Prof. Andrew Ng</h4>
                                        <p class="text-sm text-gray-600">Machine Learning</p>
                                    </div>
                                </div>
                            </label>
                            <label for="prof-fei-fei">
                                <input id="prof-fei-fei" type="radio" name="professor" value="prof-fei-fei" class="peer hidden">
                                <div class="p-4 border border-gray-300 rounded-lg cursor-pointer hover:border-blue-500 peer-checked:border-blue-600 peer-checked:bg-blue-50 peer-checked:ring-2 h-full flex flex-row items-center">
                                     <img src="https://placehold.co/64x64/E0E7FF/4F46E5?text=FL" alt="Professor Fei-Fei Li" class="w-16 h-16 rounded-full object-cover" onerror="this.src='https://placehold.co/64x64/E0E7FF/4F46E5?text=FL'">
                                    <div class="ml-4">
                                        <h4 class="font-semibold text-gray-800">Prof. Fei-Fei Li</h4>
                                        <p class="text-sm text-gray-600">Computer Vision</p>
                                    </div>
                                </div>
                            </label>
                            <label for="prof-jurafsky">
                                <input id="prof-jurafsky" type="radio" name="professor" value="prof-jurafsky" class="peer hidden">
                                <div class="p-4 border border-gray-300 rounded-lg cursor-pointer hover:border-blue-500 peer-checked:border-blue-600 peer-checked:bg-blue-50 peer-checked:ring-2 h-full flex flex-row items-center">
                                     <img src="https://placehold.co/64x64/E0E7FF/4F46E5?text=DJ" alt="Professor Dan Jurafsky" class="w-16 h-16 rounded-full object-cover" onerror="this.src='https://placehold.co/64x64/E0E7FF/4F46E5?text=DJ'">
                                    <div class="ml-4">
                                        <h4 class="font-semibold text-gray-800">Prof. Dan Jurafsky</h4>
                                        <p class="text-sm text-gray-600">Natural Language Processing</p>
                                    </div>
                                </div>
                            </label>
                        </div>
                        <div id="interested-from" class="mt-4 hidden">
                            <label for="prof-interest-text" class="block mb-2 text-sm font-medium text-gray-700">Why are you interested in their work?</label>
                            <textarea id="prof-interest-text" class="w-full p-3 h-24 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Briefly explain why you are interested in their work, mentioning specific papers or projects if possible."></textarea>
                        </div>
                         <!-- Professor Preference Section -->
                        <div class="border border-gray-200 rounded-lg mt-4">
                            <button type="button" class="accordion-header flex justify-between items-center w-full p-4 text-left hover:bg-gray-50 focus:outline-none">
                                <span class="flex items-center">
                                    <input id="cb-prof" type="checkbox" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500" onclick="event.stopPropagation()">
                                    <label for="cb-prof" class="ml-3 text-md font-medium text-gray-800 cursor-pointer" onclick="event.stopPropagation()">Mention a Professor of Interest</label>
                                </span>
                                <svg class="accordion-icon w-5 h-5 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                            </button>
                            <div class="accordion-content hidden p-4 pt-0">
                                <p class="text-sm text-gray-500 mb-4">Mentioning a professor and your interest in their work can strengthen your application.</p>
                                <div class="space-y-4">
                                    <div>
                                        <label for="prof-name" class="block mb-2 text-sm font-medium text-gray-700">Professor's Name</label>
                                        <input type="text" id="prof-name" class="block w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., Prof. Andrew Ng">
                                    </div>
                                    <div>
                                        <label for="prof-title" class="block mb-2 text-sm font-medium text-gray-700">Professor's Title / Research Area</label>
                                        <input type="text" id="prof-title" class="block w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., Expert in Machine Learning">
                                    </div>
                                    <div>
                                        <label for="prof-interest-accordion" class="block mb-2 text-sm font-medium text-gray-700">Why are you interested in their work?</label>
                                        <textarea id="prof-interest-accordion" class="w-full p-3 h-24 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Briefly explain why you are interested in their work, mentioning specific papers or projects if possible."></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="step-content hidden" data-step="3">
                <h3 class="text-2xl font-semibold text-gray-700 mb-6">Step 3: Choose a Writing Style</h3>
                <p class="text-gray-500 mb-6">Select the tone and style for your SOP. The AI will adapt based on your choice.</p>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <label>
                        <input type="radio" name="model" value="formal" class="peer hidden">
                        <div class="p-6 border border-gray-300 rounded-lg cursor-pointer hover:border-blue-500 peer-checked:border-blue-600 peer-checked:bg-blue-50 peer-checked:ring-2 h-full">
                            <h4 class="text-lg font-semibold text-gray-800">Formal & Academic</h4>
                            <p class="text-sm text-gray-600 mt-1">Professional, clear, and structured. Best for most graduate programs.</p>
                            <div class="mt-4 border-t border-gray-200 pt-3">
                                <p class="text-xs text-gray-500 italic">"My extensive research in quantum computing has prepared me for the rigorous demands of this doctoral program."</p>
                            </div>
                        </div>
                    </label>
                    <label>
                        <input type="radio" name="model" value="confident" class="peer hidden" checked>
                        <div class="p-6 border border-gray-300 rounded-lg cursor-pointer hover:border-blue-500 peer-checked:border-blue-600 peer-checked:bg-blue-50 peer-checked:ring-2 h-full">
                            <h4 class="text-lg font-semibold text-gray-800">Confident & Persuasive</h4>
                            <p class="text-sm text-gray-600 mt-1">Direct and impactful. Highlights your achievements and potential.</p>
                            <div class="mt-4 border-t border-gray-200 pt-3">
                                <p class="text-xs text-gray-500 italic">"I am confident that my proven track record of innovation makes me an ideal candidate to drive success in your program."</p>
                            </div>
                        </div>
                    </label>
                    <label>
                        <input type="radio" name="model" value="creative" class="peer hidden">
                        <div class="p-6 border border-gray-300 rounded-lg cursor-pointer hover:border-blue-500 peer-checked:border-blue-600 peer-checked:bg-blue-50 peer-checked:ring-2 h-full">
                            <h4 class="text-lg font-semibold text-gray-800">Creative & Personal</h4>
                            <p class="text-sm text-gray-600 mt-1">Uses storytelling. Best for humanities or design programs.</p>
                            <div class="mt-4 border-t border-gray-200 pt-3">
                                <p class="text-xs text-gray-500 italic">"From the moment I booted up my first computer, I was captivated by the endless possibilities of code."</p>
                            </div>
                        </div>
                    </label>
                    <label>
                        <input type="radio" name="model" value="custom" class="peer hidden">
                        <div class="p-6 border border-gray-300 rounded-lg cursor-pointer hover:border-blue-500 peer-checked:border-blue-600 peer-checked:bg-blue-50 peer-checked:ring-2 h-full">
                            <h4 class="text-lg font-semibold text-gray-800">Custom</h4>
                            <p class="text-sm text-gray-600 mt-1">Define your own style. Provide keywords for the AI.</p>
                            <div class="mt-4 border-t border-gray-200 pt-3">
                                <p class="text-xs text-gray-500 italic">e.g., "Enthusiastic, slightly informal, and optimistic."</p>
                            </div>
                        </div>
                    </label>
                </div>
            </div>

            <div class="step-content hidden" data-step="4">
                <h3 class="text-2xl font-semibold text-gray-700 mb-6">Step 4: Select a Design (Required)</h3>
                <p class="text-gray-500 mb-6">Choose a template for your final document.</p>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <label>
                        <input type="radio" name="design" value="minimal" class="peer hidden" checked>
                        <div class="border border-gray-300 rounded-lg cursor-pointer overflow-hidden peer-checked:ring-2 peer-checked:ring-offset-2 peer-checked:ring-blue-600">
                            <img src="https://placehold.co/600x400/F3F4F6/9CA3AF?text=Minimalist+Design" alt="Classic Minimalist Design" class="w-full h-64 object-cover bg-gray-200" onerror="this.src='https://placehold.co/600x400/F3F4F6/9CA3AF?text=Minimalist+Design'">
                            <p class="text-center p-3 text-sm font-medium text-gray-700">Classic Minimalist</p>
                        </div>
                    </label>
                    <label>
                        <input type="radio" name="design" value="serif" class="peer hidden">
                        <div class="border border-gray-300 rounded-lg cursor-pointer overflow-hidden peer-checked:ring-2 peer-checked:ring-offset-2 peer-checked:ring-blue-600">
                            <img src="https://placehold.co/600x400/F3F4F6/9CA3AF?text=Serif+Design" alt="Modern Serif Design" class="w-full h-64 object-cover bg-gray-200" onerror="this.src='https://placehold.co/600x400/F3F4F6/9CA3AF?text=Serif+Design'">
                            <p class="text-center p-3 text-sm font-medium text-gray-700">Modern Serif</p>
                        </div>
                    </label>
                    <label>
                        <input type="radio" name="design" value="modern" class="peer hidden">
                        <div class="border border-gray-300 rounded-lg cursor-pointer overflow-hidden peer-checked:ring-2 peer-checked:ring-offset-2 peer-checked:ring-blue-600">
                            <img src="https://placehold.co/600x400/F3F4F6/9CA3AF?text=Modern+Design" alt="Modern Design" class="w-full h-64 object-cover bg-gray-200" onerror="this.src='https://placehold.co/600x400/F3F4F6/9CA3AF?text=Modern+Design'">
                            <p class="text-center p-3 text-sm font-medium text-gray-700">Modern</p>
                        </div>
                    </label>
                    <label>
                        <input type="radio" name="design" value="bold" class="peer hidden">
                        <div class="border border-gray-300 rounded-lg cursor-pointer overflow-hidden peer-checked:ring-2 peer-checked:ring-offset-2 peer-checked:ring-blue-600">
                            <img src="https://placehold.co/600x400/F3F4F6/9CA3AF?text=Bold+Header+Design" alt="Bold Header Design" class="w-full h-64 object-cover bg-gray-200" onerror="this.src='https://placehold.co/600x400/F3F4F6/9CA3AF?text=Bold+Header+Design'">
                            <p class="text-center p-3 text-sm font-medium text-gray-700">Bold Header</p>
                        </div>
                    </label>
                </div>
            </div>

            <div class="step-content hidden" data-step="5">
                <h3 class="text-2xl font-semibold text-gray-700 mb-6">Step 5: Preview Your SOP</h3>
                <p class="text-gray-500 mb-6">Here is a preview of your generated Statement of Purpose. You can download the full, high-quality PDF.</p>

                <!-- Live Edit Controls -->
                <div class="bg-gray-50 border border-gray-200 rounded-lg p-4 mb-6">
                    <div class="flex flex-wrap items-center justify-between gap-4 mb-4">
                        <p class="text-sm text-gray-600 font-medium">Live Controls</p>
                        <div class="flex items-center space-x-4">
                            <button type="button" class="edit-step-btn text-xs font-medium text-blue-600 hover:underline" data-step="1">Edit Details</button>
                            <button type="button" class="edit-step-btn text-xs font-medium text-blue-600 hover:underline" data-step="2">Edit Content</button>
                        </div>
                    </div>

                    <!-- Live Design Selector -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Design</label>
                        <div id="live-design-controls" class="grid grid-cols-2 md:grid-cols-4 gap-3">
                            <label>
                                <input type="radio" name="live-design" value="minimal" class="peer hidden" checked>
                                <div class="text-center p-2 border border-gray-300 rounded-lg cursor-pointer text-xs peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-600">Minimalist</div>
                            </label>
                            <label>
                                <input type="radio" name="live-design" value="serif" class="peer hidden">
                                <div class="text-center p-2 border border-gray-300 rounded-lg cursor-pointer text-xs peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-600">Serif</div>
                            </label>
                            <label>
                                <input type="radio" name="live-design" value="modern" class="peer hidden">
                                <div class="text-center p-2 border border-gray-300 rounded-lg cursor-pointer text-xs peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-600">Modern</div>
                            </label>
                            <label>
                                <input type="radio" name="live-design" value="bold" class="peer hidden">
                                <div class="text-center p-2 border border-gray-300 rounded-lg cursor-pointer text-xs peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-600">Bold</div>
                            </label>
                        </div>
                    </div>

                    <!-- Live Style Selector -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Writing Style</label>
                        <select id="live-style-controls" class="w-full p-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm">
                            <option value="formal">Formal & Academic</option>
                            <option value="confident" selected>Confident & Persuasive</option>
                            <option value="creative">Creative & Personal</option>
                        </select>
                    </div>

                    <!-- Save Edits Button -->
                    <div class="mt-4 pt-4 border-t border-gray-200">
                         <button type="button" id="save-edits-btn" class="w-full py-2 px-4 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 text-sm">Save & Apply Edits</button>
                         <p class="text-xs text-gray-500 mt-2 text-center">Click this after editing the text below to keep your changes when switching designs.</p>
                    </div>
                </div>

                <div id="sop-preview-container-wrapper" class="relative border border-gray-300 rounded-lg p-6 overflow-hidden">
                    <div id="preview-overlay" class="absolute inset-0 bg-white/50 backdrop-blur-sm z-10 flex items-center justify-center">
                        <div id="preview-ready-state" class="text-center p-6 bg-white/80 rounded-lg shadow-lg">
                            <svg class="w-12 h-12 text-blue-600 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg>
                            <h4 class="text-lg font-semibold text-gray-800 mt-3">Preview is Ready</h4>
                            <p class="text-gray-600">Click "Generate & Download" to get the full version.</p>
                        </div>
                        <div id="preview-loading-state" class="hidden text-center p-6">
                            <svg class="animate-spin h-10 w-10 text-blue-600 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                            <h4 class="text-lg font-semibold text-gray-800 mt-3">Generating SOP...</h4>
                        </div>
                    </div>
                    
                    <div id="sop-preview-container" class="text-gray-400 outline-none" contenteditable="true">
                        <h4 class="text-xl font-bold mb-4">Statement of Purpose: [Your Name]</h4>
                        <p class="mb-4">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed non risus. Suspendisse lectus tortor, dignissim sit amet, adipiscing nec, ultricies sed, dolor. Cras elementum ultrices diam. Maecenas ligula massa, varius a, semper congue, euismod non, mi. Proin porttitor, orci nec nonummy molestie, enim est eleifend mi...</p>
                        <p class="mb-4">Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Vestibulum tortor quam, feugiat vitae, ultricies eget, tempor sit amet, ante. Donec eu libero sit amet quam egestas semper. Aenean ultricies mi vitae est. Mauris placerat eleifend leo.</p>
                        <p>Quisque sit amet est et sapien ullamcorper pharetra. Vestibulum erat wisi, condimentum sed, commodo vitae, ornare sit amet, wisi. Aenean fermentum, elit eget tincidunt condimentum, eros ipsum rutrum orci, sagittis tempus lacus enim ac dui. Donec non enim in turpis pulvinar facilisis...</p>
                    </div>
                </div>
            </div>

            <div class="flex justify-between mt-12">
                <button type="button" id="prev-btn" class="py-2 px-6 bg-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-300 disabled:opacity-50" disabled>
                    Previous
                </button>
                <button type="button" id="next-btn" class="py-2 px-6 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700">
                    Next
                </button>
            </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Subscription Upsell Modal -->
    <div id="subscription-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 hidden p-4">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md transform transition-all relative">
            <button id="close-subscription-modal" class="absolute top-3 right-3 text-gray-400 hover:text-gray-600">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
            <div class="p-8 text-center">
                <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-blue-100 mb-4">
                    <svg class="h-6 w-6 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                </div>
                <h3 class="text-2xl font-semibold text-gray-800">Unlock Unlimited Regenerations</h3>
                <p class="text-gray-600 mt-2">Upgrade to our Pro plan to regenerate your SOP, get access to more styles, and receive an AI-powered review.</p>
                <button class="w-full mt-6 py-3 px-6 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700">Upgrade to Pro</button>
                <p class="text-xs text-gray-400 mt-3">One-time payment. Lifetime access.</p>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const totalSteps = 5;
            let currentStep = 1;
            let userEditedContent = null; // To store user's live edits

            const stepContents = document.querySelectorAll('.step-content');
            const stepperItems = document.querySelectorAll('.stepper-item');
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            // Use placeholder images for professor avatars
            const professorImages = {
                "prof-ng": "https://placehold.co/64x64/E0E7FF/4F46E5?text=AN",
                "prof-fei-fei": "https://placehold.co/64x64/E0E7FF/4F46E5?text=FL",
                "prof-jurafsky": "https://placehold.co/64x64/E0E7FF/4F46E5?text=DJ"
            };

            document.querySelectorAll('input[name="professor"]').forEach(radio => {
                const img = radio.parentElement.querySelector('img');
                const profId = radio.id;
                if (img && professorImages[profId]) {
                    img.src = professorImages[profId];
                }
            });

            // Use placeholder images for design templates
            const designImages = {
                "minimal": "https://placehold.co/600x400/F3F4F6/9CA3AF?text=Minimalist+Design",
                "serif": "https://placehold.co/600x400/F3F4F6/9CA3AF?text=Serif+Design",
                "bold": "https://placehold.co/600x400/F3F4F6/9CA3AF?text=Bold+Header+Design",
                "modern": "https://placehold.co/600x400/F3F4F6/9CA3AF?text=Modern+Design"
            };

            document.querySelectorAll('input[name="design"]').forEach(radio => {
                const img = radio.parentElement.querySelector('img');
                const designId = radio.value;
                if (img && designImages[designId]) {
                    img.src = designImages[designId];
                }
            });


            function updateUI() {
                // Update Step Content
                stepContents.forEach(step => {
                    step.classList.add('hidden');
                    if (parseInt(step.dataset.step) === currentStep) {
                        step.classList.remove('hidden');
                    }
                });

                // Update Stepper Visuals
                stepperItems.forEach((item, index) => {
                    const stepNum = parseInt(item.dataset.step);
                    const anchor = item.querySelector('.stepper-anchor'); // Get the anchor tag
                    const circle = item.querySelector('.stepper-circle');
                    const label = item.querySelector('.stepper-label');
                    // Removed line logic

                    if (stepNum < currentStep) {
                        // Completed Step
                        circle.classList.add('bg-blue-600', 'border-blue-600', 'text-white');
                        circle.classList.remove('bg-white', 'border-gray-300', 'text-gray-500');
                        if (label) label.classList.add('text-blue-600');
                        if (label) label.classList.remove('text-gray-500');
                        if (anchor) anchor.classList.remove('bg-blue-50');
                    } else if (stepNum === currentStep) {
                        // Active Step
                        circle.classList.add('bg-blue-600', 'border-blue-600', 'text-white');
                        circle.classList.remove('bg-white', 'border-gray-300', 'text-gray-500');
                        if (label) label.classList.add('text-blue-600');
                        if (label) label.classList.remove('text-gray-500');
                        if (anchor) anchor.classList.add('bg-blue-50'); // Add active background
                    } else {
                        // Future Step
                        circle.classList.remove('bg-blue-600', 'border-blue-600', 'text-white');
                        circle.classList.add('bg-white', 'border-gray-300', 'text-gray-500');
                        if (label) label.classList.remove('text-blue-600');
                        if (label) label.classList.add('text-gray-500');
                        if (anchor) anchor.classList.remove('bg-blue-50');
                    }
                });
                
                // Update Button States
                prevBtn.disabled = currentStep === 1;
                
                if (currentStep === totalSteps - 1) {
                    // On the last step *before* preview
                    nextBtn.textContent = 'Generate & Preview';
                    nextBtn.classList.replace('bg-green-600', 'bg-blue-600');
                    nextBtn.classList.replace('hover:bg-green-700', 'hover:bg-blue-700');
                } else if (currentStep === totalSteps) {
                    // On the final "Preview" step
                    nextBtn.textContent = 'Download PDF';
                    nextBtn.classList.replace('bg-blue-600', 'bg-green-600'); // Change color to green
                    nextBtn.classList.replace('hover:bg-blue-700', 'hover:bg-green-700');
                } else {
                    // All other steps
                    nextBtn.textContent = 'Next';
                    nextBtn.classList.replace('bg-green-600', 'bg-blue-600');
                    nextBtn.classList.replace('hover:bg-green-700', 'hover:bg-blue-700');
                }
            }

            function generateSopContent() {
                const previewReadyState = document.getElementById('preview-ready-state');
                const previewLoadingState = document.getElementById('preview-loading-state');
                // Pass false to not show the loading overlay on live edits
                const showLoading = arguments.length > 0 && arguments[0] === false ? false : true;
                const sopPreviewContainer = document.getElementById('sop-preview-container');
                const sopPreviewWrapper = document.getElementById('sop-preview-container-wrapper');
                const selectedDesign = document.querySelector('input[name="live-design"]:checked').value;
                const selectedStyle = document.getElementById('live-style-controls').value;

                // Show loading state
                if (showLoading) {
                    const previewOverlay = document.getElementById('preview-overlay');
                    previewOverlay.classList.remove('hidden');
                    previewReadyState.classList.add('hidden');
                    previewLoadingState.classList.remove('hidden');
                    sopPreviewWrapper.classList.remove('overflow-y-auto');
                }
                
                // Simulate AI generation
                const generationTime = showLoading ? 2500 : 100; // Faster update for live edits
                setTimeout(() => {
                    // Hide the overlay
                    if (showLoading) {
                        document.getElementById('preview-overlay').classList.add('hidden');
                    }
                    
                    let content = '';
                    const sopText = userEditedContent || `
                        <p>
                            I am applying to your Ph.D. program to research programming languages and formal methods, driven by my involvement in the open-source community. In particular, I am interested in studying the structures that represent the semantics of Python libraries in data science, machine learning, artificial intelligence, and scientific computing. My experience working in this open-source community has prepared me to integrate theoretical research with practical applications. Researching the design and implementation of abstractions for domain-specific libraries can help preserve the independence and growth of decentralized multi-stakeholder Python libraries. I aim to explore how computer science and mathematics can offer a precise language to describe and manipulate the abstractions used in the field. Pursuing this research at the University of Washington would provide a collaborative environment to engage in academic research to meet the real-world needs of the open-source community.
                        </p>
                        <p>
                            I have experience in the combination of research, community engagement, and addressing real-world user needs through my participation in open source, particularly with JupyterLab and Vega. Starting with a personal initiative to enhance the collaboration of my research group, I contributed to integrating the Vega-Lite visualization tools into JupyterLab, collaborating with project creators Dominik Moritz and Brian Granger. I relied on these relationships to build a general-purpose, open-source tool for Python data science users to optimize their interactive visualizations based on the needs of a database client. This improved Vega's debugging capabilities and contributed to published research on visualization profiling. As a core JupyterLab developer, I helped clients integrate with the Jupyter ecosystem and shared the responsibility of maintaining and enhancing the project. For example, I wrote and received a Chan Zuckerberg Initiative grant to improve the collaborative experience in Jupyter, leading to an integration of conflict-free replicated data types into JupyterLab. Overall, I enjoyed the opportunity to integrate research and user needs while navigating complex multi-stakeholder projects.
                        </p>
                        <p>
                            My engagement in the open-source Python data science community motivates my research on the interrelated technical and social challenges it faces. The shift toward heterogeneous hardware has increased the complexity of developing numeric libraries and led to fragmentation in the ecosystem, centralizing control in single-stakeholder projects like Jax, PyTorch, and Mojo. The "exilic spaces," as defined by OHearn and Grubai, of decentralized democratic open-source projects based on mutual aid and cooperative relationships, are a powerful living alternative to the market economy. By protecting them through tools that promote a bottom-up ecosystem to meet user needs and facilitate innovation, we can engage in the vital practice of navigating the difficulties of democratic governance. I hope my work can play a role in increasing the diversity and accessibility of the ecosystem by building tools that strengthen its independence.
                        </p>
                        <p>
                            My path towards exploring how programming language abstractions can aid the PyData community began at Quansight. Working with Travis Oliphant, creator of NumPy, we sought to research a new foundation for the array ecosystem in Python. I reached out to Lenore Mullin, based on her 1980s work on the 'Mathematics of Arrays' formalizing APL with the lambda calculus, and we ended up working together to integrate her work into Python. This led to the development of a generic framework, metadsl, for representing and optimizing expressions in Python, but securing funding for this type of experimental technology proved challenging. While at Quansight, I also assisted the Data APIs consortium with analyzing the usage of array API patterns in Python, giving me the opportunity to witness the difficulties in providing users with universal interfaces. After leaving Quansight, I joined a startup Linea that was working to bring database and programming language theory to assist Python data scientists. As one of their first engineers, I engaged with academic researchers as the leader in developing Lineas abstract analysis engine, which transformed Python code into a functional dataflow graph in order to support program slicing and lineage analysis. After leaving Linea, I re-focused on developing a system for abstract interpretation in Python. I learned about the work on e-graphs from the University of Washington, a technique that comes from equational reasoning. I wrote a Python library exposing the research software to a broader audience and presented it at the E-GRAPHS workshop at PLDI. I also developed an interactive visualizer, now integrated into the project, to make the work more accessible. To deepen my academic collaboration, I applied for and received an NSF fellowship to support pursuing a Ph.D. in computer science.
                        </p>
                         <p>
                            My ongoing work with e-graphs in Python gives me a jumping-off point for my overall research goals in pursuing a Ph.D. In egglog, the framework building e-graphs on top of datalog, I am interested in studying the addition of parameterized types and higher-order functions to improve expressivity and the relationship to existing compute engines, such as SQL and differential dataflow. I also want to explore how existing functional abstractions like the Mathematics of Arrays and the RSVDG can be implemented within the e-graph framework to provide a general-purpose compiler framework for numeric computation, AI, and data science. More broadly, I am interested in studying, through the lens of human-computer interaction, how frameworks for type-driven programming can assist in cross-domain and language translation to assist inter-group collaboration between library developers, as well as how concepts from the foundations of mathematics can help us the language to reason about the semantics of programming languages.
                        </p>
                        <p>
                            More specifically, at the University of Washington, I am interested in working with Zachary Tatlock, Gilbert Bernstein, Dan Grossman, and Luis Ceze on studying the abstract interpretation and compilation of machine learning code in Python. Moreover, I want to connect the academic programming language community closer with the Python ecosystem, a high-impact field that would benefit from a foundational approach to studying abstraction. By enrolling in your graduate program, I could develop longer-term working relationships with other researchers in an environment supportive of experimentation and thus connect abstract research with the needs of existing open-source communities.
                        </p>
                    `;

                    if (selectedDesign === 'modern') {
                        content = `
                            <div class="font-sans">
                                <div class="flex justify-between items-start mb-10 border-b pb-6 border-gray-200">
                                  <div>
                                    <h1 class="text-3xl font-bold text-gray-800">[Your Name]</h1>
                                    <h2 class="text-md text-blue-600 font-semibold mt-1">Ph.D. Program at the University of Washington</h2>
                                  </div>
                                  <div class="text-right text-xs text-gray-500 flex-shrink-0">
                                    <p>[Your Address]</p>
                                    <p>[Your Phone]</p>
                                    <p>[Your Email]</p>
                                  </div>
                                </div>
                                <div class="sop-body-content text-gray-700 text-sm leading-relaxed space-y-4">${sopText}</div>
                            </div>
                        `;
                    } else { // Default to Classic Minimalist
                        content = `
                            <div class="font-serif text-gray-800 text-sm leading-relaxed space-y-4">
                                <div class="mb-8">
                                    <h2 class="text-3xl font-bold">[Your Name]</h2>
                                    <p class="text-xs text-gray-600 mt-1">[Your Address] | [Your Phone] | [Your Email]</p>
                                </div>
                                <h3 class="text-lg font-bold !mb-6">Statement of Purpose: Ph.D. Program at the University of Washington</h3>
                                <div class="sop-body-content">${sopText}</div>
                            </div>
                        `;
                    }

                    sopPreviewContainer.innerHTML = content;
                    // Apply style changes
                    sopPreviewContainer.classList.remove('font-serif', 'font-sans');
                    if (selectedStyle === 'creative') {
                        sopPreviewContainer.classList.add('font-sans');
                    } else { // formal, confident
                        sopPreviewContainer.classList.add('font-serif');
                    }

                    sopPreviewContainer.classList.remove('text-gray-400');
                    sopPreviewWrapper.classList.add('overflow-y-auto');
                }, generationTime); // Simulate a 2.5-second generation time
            }

            nextBtn.addEventListener('click', () => {
                if (currentStep < totalSteps) {
                    currentStep++;
                    userEditedContent = null; // Reset edits when moving between main steps
                    if (currentStep === totalSteps) {
                        // Sync step 4 selections to live controls in step 5
                        const designSelection = document.querySelector('input[name="design"]:checked').value;
                        document.querySelector(`input[name="live-design"][value="${designSelection}"]`).checked = true;

                        const styleSelection = document.querySelector('input[name="model"]:checked').value;
                        document.getElementById('live-style-controls').value = styleSelection;
                    }
                    updateUI(); 
                    if (currentStep === totalSteps) {
                        generateSopContent();
                    }
                } else if (currentStep === totalSteps) {
                    document.getElementById('subscription-modal').classList.remove('hidden');
                }
            });

            prevBtn.addEventListener('click', () => {
                if (currentStep > 1) {
                    currentStep--;
                    userEditedContent = null; // Reset edits when moving between main steps
                    updateUI();
                }
            });

            // Close Subscription Modal
            document.getElementById('close-subscription-modal').addEventListener('click', () => {
                document.getElementById('subscription-modal').classList.add('hidden');
            });

            // Handle Edit buttons on Preview page
            document.querySelectorAll('.edit-step-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const step = parseInt(btn.dataset.step);
                    if (step > 0 && step < totalSteps) {
                        currentStep = step;
                        updateUI();
                        // Hide the preview overlay if we jump back from the preview step
                        document.getElementById('preview-overlay').classList.add('hidden');
                    }
                });
            });

            // Handle Live Edit controls on Preview page
            document.querySelectorAll('#live-design-controls input').forEach(radio => {
                radio.addEventListener('change', () => generateSopContent(false));
            });
            document.getElementById('live-style-controls').addEventListener('change', () => {
                generateSopContent(false);
            });
            document.getElementById('save-edits-btn').addEventListener('click', () => {
                const sopPreviewContainer = document.getElementById('sop-preview-container');
                // Find the core text part of the preview to save
                const contentWrapper = sopPreviewContainer.querySelector('.sop-body-content');
                if (contentWrapper) userEditedContent = contentWrapper.innerHTML;
                generateSopContent(false); // Re-apply the current design with the saved content
            });


            // Handle CV/Resume option toggle
            const cvOptions = document.querySelectorAll('input[name="cv-option"]');
            const cvUploadArea = document.getElementById('cv-upload-area');
            const existingCvArea = document.getElementById('existing-cv-area');

            cvOptions.forEach(option => {
                option.addEventListener('change', (event) => {
                    if (event.target.value === 'upload') {
                        cvUploadArea.style.display = 'flex';
                        existingCvArea.style.display = 'none';
                    } else {
                        cvUploadArea.style.display = 'none';
                        existingCvArea.style.display = 'block';
                    }
                });
            });

            // Handle Accordion for Step 2
            const accordionHeaders = document.querySelectorAll('#accordion-container .accordion-header');
            accordionHeaders.forEach(header => {
                header.addEventListener('click', () => {
                    const content = header.nextElementSibling;
                    const icon = header.querySelector('.accordion-icon');
                    
                    content.classList.toggle('hidden');
                    if (icon) icon.classList.toggle('rotate-180');

                    // Optional: Check the checkbox when opened
                    const checkbox = header.querySelector('input[type="checkbox"]');
                    if (checkbox && !content.classList.contains('hidden')) {
                        checkbox.checked = true;
                    }
                });
            });

            // Handle Professor Interest Section
            const professorRadios = document.querySelectorAll('input[name="professor"]');
            const interestedFrom = document.getElementById('interested-from');

            professorRadios.forEach(radio => {
                radio.addEventListener('change', () => {
                    if (radio.checked) {
                        interestedFrom.classList.remove('hidden');
                    }
                });
            });

            // University Search Dropdown
            const universitySearch = document.getElementById('university-search');
            const universityDropdown = document.getElementById('university-dropdown');
            const universities = [
                "Stanford University", "Massachusetts Institute of Technology (MIT)", "Harvard University",
                "California Institute of Technology (Caltech)", "University of Oxford", "University of Cambridge",
                "Imperial College London", "ETH Zurich", "University of Chicago", "University College London (UCL)",
                "National University of Singapore (NUS)", "Princeton University", "Nanyang Technological University (NTU)",
                "Tsinghua University", "University of Pennsylvania", "Yale University", "Cornell University",
                "Columbia University", "The University of Edinburgh", "The University of Tokyo"
            ];

            universitySearch.addEventListener('input', () => {
                const filter = universitySearch.value.toUpperCase();
                universityDropdown.innerHTML = '';
                if (!filter) {
                    universityDropdown.classList.add('hidden');
                    return;
                }

                const filteredUniversities = universities.filter(uni => uni.toUpperCase().includes(filter));

                if (filteredUniversities.length) {
                    filteredUniversities.forEach(uni => {
                        const item = document.createElement('div');
                        item.textContent = uni;
                        item.className = 'p-3 hover:bg-gray-100 cursor-pointer';
                        item.addEventListener('click', () => {
                            universitySearch.value = uni;
                            universityDropdown.classList.add('hidden');
                        });
                        universityDropdown.appendChild(item);
                    });
                    universityDropdown.classList.remove('hidden');
                } else {
                    universityDropdown.classList.add('hidden');
                }
            });

            // Hide dropdown when clicking outside
            document.addEventListener('click', (e) => {
                if (!universitySearch.contains(e.target) && !universityDropdown.contains(e.target)) {
                    universityDropdown.classList.add('hidden');
                }
            });
            universitySearch.addEventListener('focus', () => {
                if(universitySearch.value) universitySearch.dispatchEvent(new Event('input'));
            });

            // Program Search Dropdown
            const programSearch = document.getElementById('program-search');
            const programDropdown = document.getElementById('program-dropdown');
            const programs = [
                "M.S. in Computer Science", "M.S. in Electrical Engineering", "Ph.D. in Physics",
                "Master of Business Administration (MBA)", "M.A. in English Literature", "M.S. in Data Science",
                "M.S. in Mechanical Engineering", "LL.M. (Master of Laws)", "M.Arch (Master of Architecture)",
                "M.S. in Biomedical Engineering", "M.S. in Civil Engineering", "Ph.D. in Chemistry"
            ];

            programSearch.addEventListener('input', () => {
                const filter = programSearch.value.toUpperCase();
                programDropdown.innerHTML = '';
                if (!filter) {
                    programDropdown.classList.add('hidden');
                    return;
                }

                const filteredPrograms = programs.filter(prog => prog.toUpperCase().includes(filter));

                if (filteredPrograms.length) {
                    filteredPrograms.forEach(prog => {
                        const item = document.createElement('div');
                        item.textContent = prog;
                        item.className = 'p-3 hover:bg-gray-100 cursor-pointer';
                        item.addEventListener('click', () => {
                            programSearch.value = prog;
                            programDropdown.classList.add('hidden');
                        });
                        programDropdown.appendChild(item);
                    });
                    programDropdown.classList.remove('hidden');
                } else {
                    programDropdown.classList.add('hidden');
                }
            });

            // Hide dropdown when clicking outside
            document.addEventListener('click', (e) => {
                if (!programSearch.contains(e.target) && !programDropdown.contains(e.target)) {
                    programDropdown.classList.add('hidden');
                }
            });
            programSearch.addEventListener('focus', () => {
                if(programSearch.value) programSearch.dispatchEvent(new Event('input'));
            });

            // Initialize the UI
            updateUI();
        });
    </script>
</body>
</html>